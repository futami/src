<!DOCTYPE html PUBLIC '-//W3C//DTD XHTML 1.0 Transitional//EN' 'http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd'>
<html xmlns='http://www.w3.org/1999/xhtml'>
<head>
<title>mem5</title>
<meta name='robots' content='noindex,nofollow' />
<meta name='generator' content='GLOBAL-6.6.4' />
<meta http-equiv='Content-Style-Type' content='text/css' />
<link rel='stylesheet' type='text/css' href='../style.css' />
</head>
<body>
<pre>
<span class='curline'><a href='../S/185.html#L18086'>mem5</a>             18086 libdb/sqlite3.c } mem5;</span>
<span class='curline'><a href='../S/185.html#L18091'>mem5</a>             18091 libdb/sqlite3.c #define mem5 GLOBAL(struct Mem5Global, mem5)</span>
<span class='curline'><a href='../S/185.html#L18097'>mem5</a>             18097 libdb/sqlite3.c #define MEM5LINK(idx) ((Mem5Link *)(&amp;mem5.zPool[(idx)*mem5.szAtom]))</span>
<span class='curline'><a href='../S/185.html#L18105'>mem5</a>             18105 libdb/sqlite3.c   assert( i&gt;=0 &amp;&amp; i&lt;mem5.nBlock );</span>
<span class='curline'><a href='../S/185.html#L18107'>mem5</a>             18107 libdb/sqlite3.c   assert( (mem5.aCtrl[i] &amp; CTRL_LOGSIZE)==iLogsize );</span>
<span class='curline'><a href='../S/185.html#L18112'>mem5</a>             18112 libdb/sqlite3.c     mem5.aiFreelist[iLogsize] = next;</span>
<span class='curline'><a href='../S/185.html#L18127'>mem5</a>             18127 libdb/sqlite3.c   assert( sqlite3_mutex_held(mem5.mutex) );</span>
<span class='curline'><a href='../S/185.html#L18128'>mem5</a>             18128 libdb/sqlite3.c   assert( i&gt;=0 &amp;&amp; i&lt;mem5.nBlock );</span>
<span class='curline'><a href='../S/185.html#L18130'>mem5</a>             18130 libdb/sqlite3.c   assert( (mem5.aCtrl[i] &amp; CTRL_LOGSIZE)==iLogsize );</span>
<span class='curline'><a href='../S/185.html#L18132'>mem5</a>             18132 libdb/sqlite3.c   x = MEM5LINK(i)-&gt;next = mem5.aiFreelist[iLogsize];</span>
<span class='curline'><a href='../S/185.html#L18135'>mem5</a>             18135 libdb/sqlite3.c     assert( x&lt;mem5.nBlock );</span>
<span class='curline'><a href='../S/185.html#L18138'>mem5</a>             18138 libdb/sqlite3.c   mem5.aiFreelist[iLogsize] = i;</span>
<span class='curline'><a href='../S/185.html#L18147'>mem5</a>             18147 libdb/sqlite3.c   sqlite3_mutex_enter(mem5.mutex);</span>
<span class='curline'><a href='../S/185.html#L18150'>mem5</a>             18150 libdb/sqlite3.c   sqlite3_mutex_leave(mem5.mutex);</span>
<span class='curline'><a href='../S/185.html#L18161'>mem5</a>             18161 libdb/sqlite3.c     int i = (int)(((u8 *)p-mem5.zPool)/mem5.szAtom);</span>
<span class='curline'><a href='../S/185.html#L18162'>mem5</a>             18162 libdb/sqlite3.c     assert( i&gt;=0 &amp;&amp; i&lt;mem5.nBlock );</span>
<span class='curline'><a href='../S/185.html#L18163'>mem5</a>             18163 libdb/sqlite3.c     iSize = mem5.szAtom * (1 &lt;&lt; (mem5.aCtrl[i]&amp;CTRL_LOGSIZE));</span>
<span class='curline'><a href='../S/185.html#L18189'>mem5</a>             18189 libdb/sqlite3.c   if( (u32)nByte&gt;mem5.maxRequest ){</span>
<span class='curline'><a href='../S/185.html#L18190'>mem5</a>             18190 libdb/sqlite3.c     mem5.maxRequest = nByte;</span>
<span class='curline'><a href='../S/185.html#L18201'>mem5</a>             18201 libdb/sqlite3.c   for(iFullSz=mem5.szAtom, iLogsize=0; iFullSz&lt;nByte; iFullSz *= 2, iLogsize++){}</span>
<span class='curline'><a href='../S/185.html#L18207'>mem5</a>             18207 libdb/sqlite3.c   for(iBin=iLogsize; iBin&lt;=LOGMAX &amp;&amp; mem5.aiFreelist[iBin]&lt;0; iBin++){}</span>
<span class='curline'><a href='../S/185.html#L18213'>mem5</a>             18213 libdb/sqlite3.c   i = mem5.aiFreelist[iBin];</span>
<span class='curline'><a href='../S/185.html#L18220'>mem5</a>             18220 libdb/sqlite3.c     mem5.aCtrl[i+newSize] = CTRL_FREE | iBin;</span>
<span class='curline'><a href='../S/185.html#L18223'>mem5</a>             18223 libdb/sqlite3.c   mem5.aCtrl[i] = iLogsize;</span>
<span class='curline'><a href='../S/185.html#L18226'>mem5</a>             18226 libdb/sqlite3.c   mem5.nAlloc++;</span>
<span class='curline'><a href='../S/185.html#L18227'>mem5</a>             18227 libdb/sqlite3.c   mem5.totalAlloc += iFullSz;</span>
<span class='curline'><a href='../S/185.html#L18228'>mem5</a>             18228 libdb/sqlite3.c   mem5.totalExcess += iFullSz - nByte;</span>
<span class='curline'><a href='../S/185.html#L18229'>mem5</a>             18229 libdb/sqlite3.c   mem5.currentCount++;</span>
<span class='curline'><a href='../S/185.html#L18230'>mem5</a>             18230 libdb/sqlite3.c   mem5.currentOut += iFullSz;</span>
<span class='curline'><a href='../S/185.html#L18231'>mem5</a>             18231 libdb/sqlite3.c   if( mem5.maxCount&lt;mem5.currentCount ) mem5.maxCount = mem5.currentCount;</span>
<span class='curline'><a href='../S/185.html#L18232'>mem5</a>             18232 libdb/sqlite3.c   if( mem5.maxOut&lt;mem5.currentOut ) mem5.maxOut = mem5.currentOut;</span>
<span class='curline'><a href='../S/185.html#L18237'>mem5</a>             18237 libdb/sqlite3.c   memset(&amp;mem5.zPool[i*mem5.szAtom], 0xAA, iFullSz);</span>
<span class='curline'><a href='../S/185.html#L18241'>mem5</a>             18241 libdb/sqlite3.c   return (void*)&amp;mem5.zPool[i*mem5.szAtom];</span>
<span class='curline'><a href='../S/185.html#L18254'>mem5</a>             18254 libdb/sqlite3.c   iBlock = (int)(((u8 *)pOld-mem5.zPool)/mem5.szAtom);</span>
<span class='curline'><a href='../S/185.html#L18257'>mem5</a>             18257 libdb/sqlite3.c   assert( iBlock&gt;=0 &amp;&amp; iBlock&lt;mem5.nBlock );</span>
<span class='curline'><a href='../S/185.html#L18258'>mem5</a>             18258 libdb/sqlite3.c   assert( ((u8 *)pOld-mem5.zPool)%mem5.szAtom==0 );</span>
<span class='curline'><a href='../S/185.html#L18259'>mem5</a>             18259 libdb/sqlite3.c   assert( (mem5.aCtrl[iBlock] &amp; CTRL_FREE)==0 );</span>
<span class='curline'><a href='../S/185.html#L18261'>mem5</a>             18261 libdb/sqlite3.c   iLogsize = mem5.aCtrl[iBlock] &amp; CTRL_LOGSIZE;</span>
<span class='curline'><a href='../S/185.html#L18263'>mem5</a>             18263 libdb/sqlite3.c   assert( iBlock+size-1&lt;(u32)mem5.nBlock );</span>
<span class='curline'><a href='../S/185.html#L18265'>mem5</a>             18265 libdb/sqlite3.c   mem5.aCtrl[iBlock] |= CTRL_FREE;</span>
<span class='curline'><a href='../S/185.html#L18266'>mem5</a>             18266 libdb/sqlite3.c   mem5.aCtrl[iBlock+size-1] |= CTRL_FREE;</span>
<span class='curline'><a href='../S/185.html#L18267'>mem5</a>             18267 libdb/sqlite3.c   assert( mem5.currentCount&gt;0 );</span>
<span class='curline'><a href='../S/185.html#L18268'>mem5</a>             18268 libdb/sqlite3.c   assert( mem5.currentOut&gt;=(size*mem5.szAtom) );</span>
<span class='curline'><a href='../S/185.html#L18269'>mem5</a>             18269 libdb/sqlite3.c   mem5.currentCount--;</span>
<span class='curline'><a href='../S/185.html#L18270'>mem5</a>             18270 libdb/sqlite3.c   mem5.currentOut -= size*mem5.szAtom;</span>
<span class='curline'><a href='../S/185.html#L18271'>mem5</a>             18271 libdb/sqlite3.c   assert( mem5.currentOut&gt;0 || mem5.currentCount==0 );</span>
<span class='curline'><a href='../S/185.html#L18272'>mem5</a>             18272 libdb/sqlite3.c   assert( mem5.currentCount&gt;0 || mem5.currentOut==0 );</span>
<span class='curline'><a href='../S/185.html#L18274'>mem5</a>             18274 libdb/sqlite3.c   mem5.aCtrl[iBlock] = CTRL_FREE | iLogsize;</span>
<span class='curline'><a href='../S/185.html#L18283'>mem5</a>             18283 libdb/sqlite3.c     if( (iBuddy+(1&lt;&lt;iLogsize))&gt;mem5.nBlock ) break;</span>
<span class='curline'><a href='../S/185.html#L18284'>mem5</a>             18284 libdb/sqlite3.c     if( mem5.aCtrl[iBuddy]!=(CTRL_FREE | iLogsize) ) break;</span>
<span class='curline'><a href='../S/185.html#L18288'>mem5</a>             18288 libdb/sqlite3.c       mem5.aCtrl[iBuddy] = CTRL_FREE | iLogsize;</span>
<span class='curline'><a href='../S/185.html#L18289'>mem5</a>             18289 libdb/sqlite3.c       mem5.aCtrl[iBlock] = 0;</span>
<span class='curline'><a href='../S/185.html#L18292'>mem5</a>             18292 libdb/sqlite3.c       mem5.aCtrl[iBlock] = CTRL_FREE | iLogsize;</span>
<span class='curline'><a href='../S/185.html#L18293'>mem5</a>             18293 libdb/sqlite3.c       mem5.aCtrl[iBuddy] = 0;</span>
<span class='curline'><a href='../S/185.html#L18301'>mem5</a>             18301 libdb/sqlite3.c   memset(&amp;mem5.zPool[iBlock*mem5.szAtom], 0x55, size);</span>
<span class='curline'><a href='../S/185.html#L18380'>mem5</a>             18380 libdb/sqlite3.c   for(iFullSz=mem5.szAtom; iFullSz&lt;n; iFullSz *= 2);</span>
<span class='curline'><a href='../S/185.html#L18416'>mem5</a>             18416 libdb/sqlite3.c   mem5.mutex = 0;</span>
<span class='curline'><a href='../S/185.html#L18429'>mem5</a>             18429 libdb/sqlite3.c   mem5.szAtom = (1&lt;&lt;nMinLog);</span>
<span class='curline'><a href='../S/185.html#L18430'>mem5</a>             18430 libdb/sqlite3.c   while( (int)sizeof(Mem5Link)&gt;mem5.szAtom ){</span>
<span class='curline'><a href='../S/185.html#L18431'>mem5</a>             18431 libdb/sqlite3.c     mem5.szAtom = mem5.szAtom &lt;&lt; 1;</span>
<span class='curline'><a href='../S/185.html#L18434'>mem5</a>             18434 libdb/sqlite3.c   mem5.nBlock = (nByte / (mem5.szAtom+sizeof(u8)));</span>
<span class='curline'><a href='../S/185.html#L18435'>mem5</a>             18435 libdb/sqlite3.c   mem5.zPool = zByte;</span>
<span class='curline'><a href='../S/185.html#L18436'>mem5</a>             18436 libdb/sqlite3.c   mem5.aCtrl = (u8 *)&amp;mem5.zPool[mem5.nBlock*mem5.szAtom];</span>
<span class='curline'><a href='../S/185.html#L18439'>mem5</a>             18439 libdb/sqlite3.c     mem5.aiFreelist[ii] = -1;</span>
<span class='curline'><a href='../S/185.html#L18445'>mem5</a>             18445 libdb/sqlite3.c     if( (iOffset+nAlloc)&lt;=mem5.nBlock ){</span>
<span class='curline'><a href='../S/185.html#L18446'>mem5</a>             18446 libdb/sqlite3.c       mem5.aCtrl[iOffset] = ii | CTRL_FREE;</span>
<span class='curline'><a href='../S/185.html#L18450'>mem5</a>             18450 libdb/sqlite3.c     assert((iOffset+nAlloc)&gt;mem5.nBlock);</span>
<span class='curline'><a href='../S/185.html#L18455'>mem5</a>             18455 libdb/sqlite3.c     mem5.mutex = sqlite3MutexAlloc(SQLITE_MUTEX_STATIC_MEM);</span>
<span class='curline'><a href='../S/185.html#L18466'>mem5</a>             18466 libdb/sqlite3.c   mem5.mutex = 0;</span>
<span class='curline'><a href='../S/185.html#L18491'>mem5</a>             18491 libdb/sqlite3.c   nMinLog = memsys5Log(mem5.szAtom);</span>
<span class='curline'><a href='../S/185.html#L18493'>mem5</a>             18493 libdb/sqlite3.c     for(n=0, j=mem5.aiFreelist[i]; j&gt;=0; j = MEM5LINK(j)-&gt;next, n++){}</span>
<span class='curline'><a href='../S/185.html#L18494'>mem5</a>             18494 libdb/sqlite3.c     fprintf(out, "freelist items of size %d: %d\n", mem5.szAtom &lt;&lt; i, n);</span>
<span class='curline'><a href='../S/185.html#L18496'>mem5</a>             18496 libdb/sqlite3.c   fprintf(out, "mem5.nAlloc       = %llu\n", mem5.nAlloc);</span>
<span class='curline'><a href='../S/185.html#L18497'>mem5</a>             18497 libdb/sqlite3.c   fprintf(out, "mem5.totalAlloc   = %llu\n", mem5.totalAlloc);</span>
<span class='curline'><a href='../S/185.html#L18498'>mem5</a>             18498 libdb/sqlite3.c   fprintf(out, "mem5.totalExcess  = %llu\n", mem5.totalExcess);</span>
<span class='curline'><a href='../S/185.html#L18499'>mem5</a>             18499 libdb/sqlite3.c   fprintf(out, "mem5.currentOut   = %u\n", mem5.currentOut);</span>
<span class='curline'><a href='../S/185.html#L18500'>mem5</a>             18500 libdb/sqlite3.c   fprintf(out, "mem5.currentCount = %u\n", mem5.currentCount);</span>
<span class='curline'><a href='../S/185.html#L18501'>mem5</a>             18501 libdb/sqlite3.c   fprintf(out, "mem5.maxOut       = %u\n", mem5.maxOut);</span>
<span class='curline'><a href='../S/185.html#L18502'>mem5</a>             18502 libdb/sqlite3.c   fprintf(out, "mem5.maxCount     = %u\n", mem5.maxCount);</span>
<span class='curline'><a href='../S/185.html#L18503'>mem5</a>             18503 libdb/sqlite3.c   fprintf(out, "mem5.maxRequest   = %u\n", mem5.maxRequest);</span>
</pre>
</body>
</html>
